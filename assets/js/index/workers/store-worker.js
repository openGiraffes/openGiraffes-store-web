"use strict";const WORKER_NAME="Store";importScripts("common.js");const opengiraffes=["https://storedb.opengiraffes.top/data.json"],bhackers=["https://banana-hackers.gitlab.io/store-db/data.json","https://bananahackers.github.io/store-db/data.json"];let stores=opengiraffes;const opengiraffesCounter=["https://opengiraffes-rating.herokuapp.com/download_counter/"],bhackersCounter=["https://bhackers.uber.space/srs/v1/download_counter/"],downloadCounters=opengiraffesCounter;onmessage=function(){wLog("log","Store worker started.");const o={categories:{all:{name:"All apps",icon:"fas fa-store",locales:[{"zh-CN":"所有应用"}]}},apps:{raw:[],categorical:{},downloadCounts:{}},generatedAt:null};function e(){o.categories={},o.apps.raw=[],o.apps.categorical={},o.apps.downloadCounts={}}for(const a of stores){wLog("log","Making request to store: "+a);const r=syncJSONRequest({type:"GET",url:a,timeout:1e4,headers:fixedHeaders});if(r.success){wLog("log",'Received successful response from "'+a+'".');try{const e=r.data;if(e.generated_at&&(wLog("log",'Found data "generated_at".'),o.generatedAt=e.generated_at),e.categories){wLog("log",'Found data "categories".');for(const a in e.categories)o.categories[a]=e.categories[a]}if(e.apps){wLog("log",'Found data "apps".'),o.apps.raw=e.apps;for(const e of o.apps.raw)for(const a of e.meta.categories)o.apps.categorical[a]||(o.apps.categorical[a]={}),o.apps.categorical[a][e.name]||(o.apps.categorical[a][e.name]=e);o.apps.categorical.all||(o.apps.categorical.all={});for(const e in o.categories)for(const a in o.apps.categorical[e])o.apps.categorical.all[a]||(o.apps.categorical.all[a]=o.apps.categorical[e][a])}break}catch(o){wLog("error","Error parsing response from store: "+o),e()}}else wLog("error","Error making request to store: "+r.error),e()}if(o.apps.raw!==[])for(const e of downloadCounters){wLog("log","Making request to download counter: "+e);const a=syncJSONRequest({type:"GET",url:e,timeout:1e4,headers:fixedHeaders});if(a.success)try{wLog("log","Received successful response from: "+e),o.apps.downloadCounts=a.data}catch(o){wLog("error","Error parsing response from download counter: "+o)}else wLog("error","Error making request to download counter: "+a.error)}wLog("log","Store worker completed!"),postMessage(o)};